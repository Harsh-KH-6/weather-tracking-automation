name: Weather Data Logger

on:
  schedule:
    # Run 5 times daily: 6 AM, 10 AM, 2 PM, 6 PM, 10 PM IST (UTC+5:30)
    # Converted to UTC: 00:30, 04:30, 08:30, 12:30, 16:30 UTC
    - cron: '30 0,4,8,12,16 * * *'
  workflow_dispatch:  # Allow manual triggering

jobs:
  log-weather:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests
        
    - name: Run weather logging script
      env:
        WEATHER_API_KEY: ${{ secrets.WEATHER_API_KEY }}
      run: python log_weather.py
      
    - name: Configure Git
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        
    - name: Commit and push changes
      run: |
        # Check if there are any changes to commit
        if git diff --quiet; then
          echo "No changes to commit"
        else
          # Add the CSV file
          git add weather_log.csv
          
          # Get current timestamp for commit message
          TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S UTC')
          
          # Create commit message with weather summary
          echo "ðŸŒ¤ï¸ Weather Update - $TIMESTAMP" > commit_msg.txt
          echo "" >> commit_msg.txt
          echo "Automated weather data collection for Indian cities:" >> commit_msg.txt
          echo "- Mumbai, Hyderabad, Delhi, Chennai, Kolkata" >> commit_msg.txt
          echo "" >> commit_msg.txt
          echo "This commit updates the weather_log.csv file with current weather conditions." >> commit_msg.txt
          echo "Generated by GitHub Actions workflow." >> commit_msg.txt
          
          # Commit with the custom message
          git commit -F commit_msg.txt
          
          # Push changes
          git push
          
          echo "âœ… Successfully committed and pushed weather data"
        fi 